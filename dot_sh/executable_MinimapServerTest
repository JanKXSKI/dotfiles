#! /usr/bin/env bash
rm run/log-*

rund="$(dirname $0)/run"
mkdir -p "$rund"
. ~/.sh/logging.sh "$rund"

exec {fd}< <(./MinimapServer)
socket="$rund/$!.socket"
while [[ ! -e $socket ]]; do sleep 0.1s; done
function request {
    echo "init 20 30"
    echo "setPath MinimapServer"
    echo "range 12 40"
    echo "cursor 23"
    echo "preview"
}
request | nc -vU "$socket" || (echo "failed to connect"; exit)
cat <&$fd
